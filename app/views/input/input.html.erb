<html>
<head>
	

	<style type="text/css">

	</style>

</head>

<body>


		<div class="container">
		    <h1>Search for an Artist</h1>
		    <form id="search-form">
		        <input type="text" id="query" value="" class="form-control" />
		        <input type="submit" id="search" class="btn btn-primary" value="Search" />
		    </form>
		    <div id="results"></div>
		</div>

<br>

	<div>
		<h2> Please input 10 artists! </h2>
		<div id="artist1"><h3>Artist 1</h3></div>
		<div id="artist2"><h3>Artist 2</h3></div>
		<div id="artist3"><h3>Artist 3</h3></div>
		<div id="artist4"><h3>Artist 4</h3></div>
		<div id="artist5"><h3>Artist 5</h3></div>
		<div id="artist6"><h3>Artist 6</h3></div>
		<div id="artist7"><h3>Artist 7</h3></div>
		<div id="artist8"><h3>Artist 8</h3></div>
		<div id="artist9"><h3>Artist 9</h3></div>
		<div id="artist10"><h3>Artist 10</h3></div>
	</div>
	







<script id="results-template" type="text/x-handlebars-template">
    {{#each albums.items}}
    <div style="background-image:url({{images.0.url}})" data-album-id="{{id}}" class="cover"></div>
    {{/each}}
</script>

<script type="text/javascript">
	

		// find template and compile it
		var templateSource = document.getElementById('results-template').innerHTML,
		    template = Handlebars.compile(templateSource),
		    resultsPlaceholder = document.getElementById('results'),
		    playingCssClass = 'playing',
		    audioObject = null;

		var fetchTracks = function (albumId, callback) {
		    $.ajax({
		        url: 'https://api.spotify.com/v1/albums/' + albumId,
		        success: function (response) {
		            callback(response);
		        }
		    });
		};

		var searchAlbums = function (query) {
		    $.ajax({
		        url: 'https://api.spotify.com/v1/search',
		        data: {
		            q: query,
		            type: 'album'
		        },
		        success: function (response) {
		            resultsPlaceholder.innerHTML = template(response);
		        }
		    });
		};

		results.addEventListener('click', function(e) {
		    var target = e.target;
		    if (target !== null && target.classList.contains('cover')) {
		        if (target.classList.contains(playingCssClass)) {
		            audioObject.pause();
		        } else {
		            if (audioObject) {
		                audioObject.pause();
		            }
		            fetchTracks(target.getAttribute('data-album-id'), function(data) {            
		                audioObject = new Audio(data.tracks.items[0].preview_url);
		                audioObject.play();
		                target.classList.add(playingCssClass);
		                audioObject.addEventListener('ended', function() {
		                    target.classList.remove(playingCssClass);
		                });
		                audioObject.addEventListener('pause', function() {
		                    target.classList.remove(playingCssClass);
		               });
		            });
		        }
		    }
		});

		document.getElementById('search-form').addEventListener('submit', function (e) {
		    e.preventDefault();
		    searchAlbums(document.getElementById('query').value);
		}, false);

</script>

</body>

